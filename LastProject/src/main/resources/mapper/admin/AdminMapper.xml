<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.yedam.app.admin.mapper.AdminMapper">
	<select id="getMembList" resultType="MembManageVO">
	<![CDATA[
	 	select b.*
		from(select rownum rn , a.*
		     from(select m.memb_no , nm , id,decode(stop_no,null,'정상','활동중지') state, join_dt
		         from member m left join ( select *
		                                  from stop_yn
		                                  where end_dt > sysdate
		                                  ) s
		         on m.memb_no = s.memb_no
		         order by join_dt
		         ) a
		     where rownum <= #{page}*#{perPage}
		    ) b
		where rn > (#{page}-1)*#{perPage}
		]]>
	</select>
	<!-- 멤버 전체수 -->
	<select id="membCnt" resultType="int">
		select count(*)
		from member
	</select>
	
	<!-- 회원 정지기간 설정 -->
	<insert id="memberBan">
		 insert into stop_yn (STOP_NO,
                             MEMB_NO,
                             START_DT,
                             END_DT,
                             STOP_PERIOD)
        values ('stp-'||stop_seq.nextval,
        		#{membNo},
        		sysdate,
        		sysdate+#{period},
        		#{period})
	</insert>
</mapper>