<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yedam.app.member.mapper.MemberMapper">

	<!-- login 시 회원 정보 조회 -->
	<select id="loginCheck" resultType="MembVO">
		SELECT * FROM MEMBER
		WHERE id=#{id}
		AND pwd=#{pwd}
	</select>
	
	<!-- 임시 비밀번호 발급 후 로그인 시 정보 조회 -->
	<select id="loginCheckPwd" resultType="MembVO">
		SELECT * FROM MEMBER
		WHERE id = #{id}
		AND temp_pwd = #{tempPwd}
	</select>
	
	<!-- 아이디로 단건조회 -->
	<select id="selectOneMemb" resultType="MembVO" parameterType="String">
		SELECT * FROM MEMBER WHERE id=#{id}
	</select>

	<!-- 회원가입 시 닉네임 중복확인 -->
	<select id="nickCheck" resultType="int">
		SELECT COUNT(*) 
		FROM MEMBER
		WHERE nick = #{nick}
	</select>
	
	<!-- 회원가입 시 id 중복확인 -->
	<select id="idCheck" resultType="int">
		SELECT COUNT(*) 
		FROM MEMBER
		WHERE id = #{id}
	</select>
	
	<insert id="signUpMemb" parameterType="MembVO">
		<selectKey keyProperty="membNo" resultType="string" order="BEFORE">
			select 'mem-' || (TO_NUMBER(MAX(SUBSTR(NVL(memb_no,0),5)))+1) as memb_no from member
		</selectKey>
		INSERT INTO MEMBER(MEMB_NO
												,NM
												,ID
												,PWD
												,NICK
												,EMAIL
												,TEL
												,POINT
												,JOIN_DT)
								VALUES( #{membNo}
												,#{nm}
												,#{id}
												,#{pwd}
												,#{nick}
												,#{email}
												,#{tel}
												,0
												,sysdate)
	</insert>
	
		<insert id="insertAddr" parameterType="AddrVO">
			<selectKey keyProperty="addrNo" resultType="string" order="BEFORE">
				select 'adr-' || (TO_NUMBER(MAX(SUBSTR(NVL(addr_no,0),5)))+1) as addr_no from address
			</selectKey>
			INSERT INTO ADDRESS(ADDR_NO,
													MEMB_NO,
													BASE_ADDR_YN,
													ZIP,
													ADDR,
													DETA_ADDR)
									VALUES(#{addrNo}
												,#{membNo}
												,'N'
												,#{zip}
												,#{addr}
												,#{detaAddr})
		</insert>
		
		<select id="getLastMembNo" resultType="String">
			<![CDATA[
				SELECT memb_no
						FROM (
						    SELECT memb_no
						    FROM member
						    ORDER BY memb_no DESC
						)
				WHERE ROWNUM = 1
				]]>
		</select>
		
		<select id="selectMembNO" resultType="String">
			select 'mem-' || (TO_NUMBER(MAX(SUBSTR(NVL(memb_no,0),5)))+1) as memb_no from member
		</select>
		
		<!-- 비밀번호 변경 -->
		<update id="updatePwd" parameterType="MembVO">
			UPDATE member
			SET 	 pwd = #{pwd},
			temp_pwd = #{tempPwd}
			WHERE  id = #{id}
		</update>
		
		<!-- 임시 비밀번호 변경 -->
		<update id="updateTempPwd" parameterType="MembVO">
			UPDATE member
			SET 	 pwd = #{pwd},
			temp_pwd = ''
			WHERE  id = #{id}
		</update>
		
		<!-- 관심종목 선택시 List 조회 -->
		<select id="myItemCheck">
			SELECT * FROM common_code
			WHERE  h_cd LIKE '%S___'
		</select>
	
</mapper>