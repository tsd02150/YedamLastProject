<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">
<head>
<meta charset="UTF-8">
<title>farmList.html</title>

<link rel="stylesheet" type="text/css" href="css/farmList.css">
<link rel="stylesheet"
	href="mall/source/plugins/themefisher-font/style.css">

<script
	src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<style>

/* 퀵메뉴 */
.quick-menu {
	position: fixed;
	top: 50%;
	right: 40px;
	transform: translateY(-50%);
	z-index: 9999;
	width: 80px; /* 퀵 메뉴의 가로 크기 조정 */
	height: 450px; /* 퀵 메뉴의 세로 크기 조정 */
	background-color: #f8f8f8;
	padding: 10px;
	border-radius: 40px; /* 직사각형 모양의 둥근 모서리를 위한 반지름 값 조정 */
	text-align: center; /* 내용 가운데 정렬 */
}

.quick-menu ul {
	list-style: none;
	padding: 0;
	margin: 0;
}

.quick-menu li {
	margin-bottom: 10px;
}

.quick-menu li a {
	text-decoration: none;
	color: #333;
}

.ctgr {
	border: none;
}

.results tr[visible='false'], .no-result {
	display: none;
}

.results tr[visible='true'] {
	display: table-row;
}

.counter {
	padding: 8px;
	color: #ccc;
}
</style>

</head>
<body id="body">
	<div layout:fragment="content" class="outer-block">
		<!-- 퀵메뉴 -->
		<div class="quick-menu">
			<ul>
				<li th:onclick="|location.href='@{mallMain}'|"
					style="cursor: pointer;"><img
					style="width: 40ox; height: 40px;"
					src="https://cdn-icons-png.flaticon.com/128/4578/4578246.png"></li>
				<li style="font-size: 12px;"
					th:onclick="|location.href='@{mallMain}'|"><a href="#">포인트몰</a></li>

				<li
					th:onclick="|location.href='@{/mall/productList(commonCd=${'S1'})}'|"
					style="cursor: pointer;"><img
					style="width: 40ox; height: 40px;"
					src="https://cdn-icons-png.flaticon.com/128/2230/2230446.png"></li>
				<li style="font-size: 12px;"><a
					href="/mall/productList?commonCd=S1">농산물</a></li>


				<li
					th:onclick="|location.href='@{/mall/productList(commonCd=${'S2'})}'|"
					style="cursor: pointer;"><img
					style="width: 40ox; height: 40px;"
					src="https://cdn-icons-png.flaticon.com/128/3361/3361370.png"></li>
				<li style="font-size: 12px;"><a
					href="/mall/productList?commonCd=S2">수산물</a></li>


				<li th:onclick="|location.href='@{basketList}'|"
					style="cursor: pointer;"><img
					style="width: 40ox; height: 40px;"
					src="https://cdn-icons-png.flaticon.com/128/545/545489.png"></li>
				<li style="font-size: 12px;"
					th:onclick="|location.href='@{basketList}'|"><a href="#">장바구니</a></li>
				<li class="top-btn" style="font-size: 12px; cursor: pointer;"><img
					style="width: 40px; height: 40px;"
					src="https://cdn-icons-png.flaticon.com/128/6015/6015743.png"
					alt="Top Button"><a href="#">TOP</a></li>
			</ul>
		</div>
		<div>
			<div id="container">
				<div class="row">
					<div class="farmImage"
						style="background-image: url(images/main/farmMain.jpg);"></div>
				</div>

				<!-- 농산물 -->
				<div>&nbsp;</div>

				<h2 th:data-common-cd="${prdtCode}" th:if="${prdtCode=='S1'}">농산물</h2>
				<h2 th:data-common-cd="${prdtCode}" th:unless="${prdtCode=='S1'}">수산물</h2>

				<div class="row-2">
					<div class="category-container">
						<!-- 농산물 카테고리 -->
						<th:block th:each="item : ${S}">
							<div>
								<button class="ctgr" id="ordBtn" type="button"
									th:data-commoncd="${item.commonCd}">[[${item.ctgr}]]</button>
								<!-- 곡류  -->
							</div>
							<div>
								<ul>
									<!-- 곡류 품목 -->
									<li id="item" style="list-style: none;" class="sub_li_1"
										th:each="prdt : ${item.childList}" th:text="${prdt.ctgr}"><a
										th:href="#"></a></li>
								</ul>
							</div>

						</th:block>

					</div>
				</div>

				<div class="row">
					<div class="selectBtn">
						<button class="lowBtn btn-light mt-3 mt-lg-0 " type="button"
							id="ordBtn">낮은 가격순</button>
						<button class="highBtn btn-light mt-3 mt-lg-0 " type="button"
							id="ordBtn">높은 가격순</button>
						<button class="sellBtn btn-light mt-3 mt-lg-0 " type="button"
							id="ordBtn">판매량</button>
					</div>

					<!-- 검색 -->
					<div class="form-group pull-right">
						<label><input type="text" class="search form-control"
							id="search" placeholder="What you looking for?" ></label>
					</div>
					<span class="counter pull-right"></span>
					<table class="table table-hover table-bordered results">
						<thead>
							<tr>
								<th>#</th>
								<th class="col-md-5 col-xs-5">Name / Surname</th>
								<th class="col-md-4 col-xs-4">Job</th>
								<th class="col-md-3 col-xs-3">City</th>
							</tr>
							<tr class="warning no-result">
								<td colspan="4"><i class="fa fa-warning"></i> No result</td>
							</tr>
						</thead>
						<tbody>
							<tr>
								<th scope="row">1</th>
								<td>강낭콩 Özbeyli</td>
								<td>UI & UX</td>
								<td>Istanbul</td>
							</tr>
							<tr>
								<th scope="row">2</th>
								<td>조</td>
								<td>Software Developer</td>
								<td>Istanbul</td>
							</tr>
							<tr>
								<th scope="row">3</th>
								<td>Egemen Özbeyli</td>
								<td>Purchasing</td>
								<td>Kocaeli</td>
							</tr>
							<tr>
								<th scope="row">4</th>
								<td>Engin Kızıl</td>
								<td>Sales</td>
								<td>Bozuyük</td>
							</tr>
						</tbody>
					</table>

				</div>

				<!-- 상품 리스트 -->

				<div class="row" id="productList">
					<div class="col-md-4 results" th:each="prdt : ${farmList}">
						<div class="product-item"
							th:onclick="|location.href='@{getFarm(prdtNo=${prdt.prdtNo})}'|">
							<div class="product-thumb">
								<span class="bage">Sale</span> <img
									th:src="|/mall/images/main/${prdt.thumb}|">
							</div>
							<div class="product-content">
								<div class="product-detail">

									<h4>
										<span class="nm"><a th:text=${prdt.nm}></a></span>
									</h4>
									<p>
										<span class="original-price" th:text="${prdt.prc} + 'P'"
											style="text-decoration: line-through;"></span> <br> <span
											class="discounted-price"
											th:text="${prdt.prc - (prdt.prc * (prdt.dcRate / 100.0))} + 'P'"></span>
									</p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- list-end -->
		</div>

		<script>
		
		/* top 버튼 */
		document.querySelector('.top-btn').addEventListener('click',
				function() {
					window.scrollTo({
						top : 0,
						behavior : 'smooth'
					});
				});
		
		//검색
		function search() {
			let search = document.getElementById(".search").value.toLowerCase();
			let listItem = document.getElementByClassName("results");
			
			for (let i=0; i< listItem.length; i++) {
				item = listItem[i].getElementByClassName("nm");
				
				if(item[0].innerHTML.toLowCase().includes(search)) {
					listItem[i].style.display ="flex"
				}else {
					listItem[i].style.display = "none"
				}
			}
		}
		
		/* $(document).ready(function() {
			  $(".search").keyup(function () {
			    var searchTerm = $(".search").val();
			    var listItem = $('.results tbody').children('tr');
			    var searchSplit = searchTerm.replace(/ /g, "'):containsi('")
			    
			  $.extend($.expr[':'], {'containsi': function(elem, i, match, array){
			        return (elem.textContent || elem.innerText || '').toLowerCase().indexOf((match[3] || "").toLowerCase()) >= 0;
			    }
			  });
			    
			  $(".results tbody tr").not(":containsi('" + searchSplit + "')").each(function(e){
			    $(this).attr('visible','false');
			  });
			
			  $(".results tbody tr:containsi('" + searchSplit + "')").each(function(e){
			    $(this).attr('visible','true');
			  });
			
			  var jobCount = $('.results tbody tr[visible="true"]').length;
			    $('.counter').text(jobCount + ' item');
			
			  if(jobCount == '0') {$('.no-result').show();}
			    else {$('.no-result').hide();}
					  });
			}); */
		
		
		
		// 상품 리스트 출력
		
	/* 	document.querySelectorAll(".ctgr").forEach(button => {
		  button.addEventListener('click', function() {
		    // 버튼 ID 출력
		    console.log(button.id);
		  });
		});
		 */
		

	let items=["prdtNo", "prc", "nm", "thumb"];
	let currentState='[[${prdtCode}]]';
		 
	//카테고리 별 정렬
	$('.ctgr').on('click',function(){
		productList();
	});
	
	function productList() {
		console.log("!!!");

		currentState=event.target.dataset.commoncd;
	    fetch("/mall/getCtgrList", {
	        method: "POST",
	        headers: {
	            'Content-Type': 'application/x-www-form-urlencoded'
	        },
	        body: 'commonCd=' + currentState
	    })
	    .then(response => response.json())
	    .then(result => {
	    	$('#productList').empty();
   			result.forEach(items=> {
     			console.log(items);
     			let divTag = `
     				<div class="col-md-4 results">
					<div class="product-item" onclick="location.href='/mall/getFarm?prdtNo=${items.prdtNo}'">
						<div class="product-thumb">
							<span class="bage">Sale</span> <img
								src="/mall/images/main/${items.thumb}">
						</div>
						<div class="product-content">
							<div class="product-detail">
								<h4>
									<span class="nm"><a>${items.nm}</a></span>
								</h4>
								<p>
									<span class="original-price"
										style="text-decoration: line-through;">${items.prc}p</span> <br> <span
										class="discounted-price">${items.prc - (items.prc * (items.dcRate / 100.0))}p</span>
								</p>
							</div>
						</div>
					</div>
				</div>
     			`;
     			document.querySelector('#productList').innerHTML+=divTag;
      		})
	    })
	    .catch(err => console.log(err));
	} 
	 
	
	//낮은 가격순
	$('.lowBtn').on('click',function(){
		lowPrcList();
	});
	
	function lowPrcList() {
	    fetch("/mall/getLowPrc", {
	        method: "POST",
	        headers: {
	            'Content-Type': 'application/x-www-form-urlencoded'
	        },
	        body: 'commonCd=' + currentState
	    })
	    .then(response => response.json())
	    .then(result => {
	    	$('#productList').empty();
   			result.forEach(items=> {
     			console.log(items);
     			let divTag = `
     				<div class="col-md-4 results">
					<div class="product-item" onclick="location.href='/mall/getFarm?prdtNo=${items.prdtNo}'">
						<div class="product-thumb">
							<span class="bage">Sale</span> <img
								src="/mall/images/main/${items.thumb}">
						</div>
						<div class="product-content">
							<div class="product-detail">
								<h4>
									<span class="nm"><a>${items.nm}</a></span>
								</h4>
								<p>
									<span class="original-price"
										style="text-decoration: line-through;">${items.prc}p</span> <br> <span
										class="discounted-price">${items.prc - (items.prc * (items.dcRate / 100.0))}p</span>
								</p>
							</div>
						</div>
					</div>
				</div>
     			`;
     			document.querySelector('#productList').innerHTML+=divTag;
      		})
	    })
	    .catch(err => console.log(err));
	} 
	
	
	//높은 가격순
	$('.highBtn').on('click',function(){
		highPrcList();
	});
	
	function highPrcList() {

	    fetch("/mall/getHighPrc", {
	        method: "POST",
	        headers: {
	            'Content-Type': 'application/x-www-form-urlencoded'
	        },
	        body: 'commonCd=' + currentState
	    })
	    .then(response => response.json())
	    .then(result => {
	    	$('#productList').empty();
   			result.forEach(items=> {
     			console.log(items);
     			let divTag = `
     				<div class="col-md-4 results">
					<div class="product-item" onclick="location.href='/mall/getFarm?prdtNo=${items.prdtNo}'">
						<div class="product-thumb">
							<span class="bage">Sale</span> <img
								src="/mall/images/main/${items.thumb}">
						</div>
						<div class="product-content">
							<div class="product-detail">
								<h4>
									<span class="nm"><a>${items.nm}</a></span>
								</h4>
								<p>
									<span class="original-price"
										style="text-decoration: line-through;">${items.prc}p</span> <br> <span
										class="discounted-price">${items.prc - (items.prc * (items.dcRate / 100.0))}p</span>
								</p>
							</div>
						</div>
					</div>
				</div>
     			`;
     			document.querySelector('#productList').innerHTML+=divTag;
      		})
	    })
	    .catch(err => console.log(err));
	} 
	

	//검색기능
	$('.searchPrdt').on('click',function(){
		searchPrdt();
	});
	
	function searchPrdt() {

	    fetch("/mall/getSearchPrdt", {
	        method: "POST",
	        headers: {
	            'Content-Type': 'application/x-www-form-urlencoded'
	        },
	        body: 'commonCd=' + currentState
	    })
	    .then(response => response.json())
	    .then(result => {
	    	$('#productList').empty();
   			result.forEach(items=> {
     			console.log(items);
     			let divTag = `
     				<div class="col-md-4 results">
					<div class="product-item" onclick="location.href='/mall/getFarm?prdtNo=${items.prdtNo}'">
						<div class="product-thumb">
							<span class="bage">Sale</span> <img
								src="/mall/images/main/${items.thumb}">
						</div>
						<div class="product-content">
							<div class="product-detail">
								<h4>
									<span class="nm"><a>${items.nm}</a></span>
								</h4>
								<p>
									<span class="original-price"
										style="text-decoration: line-through;">${items.prc}p</span> <br> <span
										class="discounted-price">${items.prc - (items.prc * (items.dcRate / 100.0))}p</span>
								</p>
							</div>
						</div>
					</div>
				</div>
     			`;
     			document.querySelector('#productList').innerHTML+=divTag;
      		})
	    })
	    .catch(err => console.log(err));
	} 
	

	</script>
	</div>
</body>
</html>