<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">
<head>
<meta charset="UTF-8">
<title>basketList.html</title>
<link rel="stylesheet" type="text/css" href="css/farmList.css">
<link rel="stylesheet"
	href="mall/source/plugins/themefisher-font/style.css">
<link rel="stylesheet"
	href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
	integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/"
	crossorigin="anonymous">
<link rel="stylesheet" href="css/basketList.css" />

<link rel=" shortcut icon" href="/images/bzshopicon.ico">
<link rel="icon" href="/images/bzshopicon.ico">

<style>

/* 퀵메뉴 */
.quick-menu {
	position: fixed;
	top: 50%;
	right: 40px;
	transform: translateY(-50%);
	z-index: 9999;
	width: 80px; /* 퀵 메뉴의 가로 크기 조정 */
	height: 450px; /* 퀵 메뉴의 세로 크기 조정 */
	background-color: #f8f8f8;
	padding: 10px;
	border-radius: 40px; /* 직사각형 모양의 둥근 모서리를 위한 반지름 값 조정 */
	text-align: center; /* 내용 가운데 정렬 */
}

.quick-menu ul {
	list-style: none;
	padding: 0;
	margin: 0;
}

.quick-menu li {
	margin-bottom: 10px;
}

.quick-menu li a {
	text-decoration: none;
	color: #333;
}
</style>


</head>
<body id="body">
	<div layout:fragment="content" class="outer-block">
	
	<!-- 퀵메뉴 -->
			<div class="quick-menu">
			<ul>
				<li th:onclick="|location.href='@{mallMain}'|"
					style="cursor: pointer;"><img
					style="width: 40ox; height: 40px;"
					src="https://cdn-icons-png.flaticon.com/128/4578/4578246.png"></li>
				<li style="font-size: 12px;"
					th:onclick="|location.href='@{mallMain}'|"><a href="#">포인트몰</a></li>

				<li th:onclick="|location.href='@{/mall/farmList(commonCd=${'S10'})}'|" style="cursor: pointer;"><img
					style="width: 40ox; height: 40px;"
					src="https://cdn-icons-png.flaticon.com/128/2230/2230446.png"></li>
				<li style="font-size: 12px;"><a
					href="/mall/farmList?commonCd=S10">농산물</a></li>


				<li th:onclick="|location.href='@{/mall/seafoodList(commonCd=${'S20'})}'|" style="cursor: pointer;"><img
					style="width: 40ox; height: 40px;"
					src="https://cdn-icons-png.flaticon.com/128/3361/3361370.png"></li>
				<li style="font-size: 12px;"><a
					href="/mall/seafoodList?commonCd=S20">수산물</a></li>


				<li th:onclick="|location.href='@{basketList}'|"
					style="cursor: pointer;"><img
					style="width: 40ox; height: 40px;"
					src="https://cdn-icons-png.flaticon.com/128/545/545489.png"></li>
				<li style="font-size: 12px;"
					th:onclick="|location.href='@{basketList}'|"><a href="#">장바구니</a></li>
				<li class="top-btn" style="font-size: 12px; cursor: pointer;"><img
					style="width: 40px; height: 40px;"
					src="https://cdn-icons-png.flaticon.com/128/6015/6015743.png"
					alt="Top Button"><a href="#">TOP</a></li>
			</ul>
		</div>
	

		<form name="orderform" id="orderform" method="post" class="orderform"
			action="/Page">

			<input type="hidden" name="cmd" value="order">
			<div class="basketdiv" id="basket">
				<div class="row head">
					<div class="subdiv">
						<div class="check">선택</div>
						<div class="img">이미지</div>
						<div class="pname">상품명</div>
					</div> 
					<div class="subdiv">	
						<div class="basketprice">가격</div>
						<div class="num">수량</div>
						<div class="sum">합계</div>
					</div>
					<div class="subdiv">
						<div class="basketcmd">삭제</div>
					</div>
					<div class="split"></div>
				</div>

				<div id="template"><!--  style="display: none;" -->
					<div class="row data">
						<div class="subdiv">
							<div class="check">
								<input type="checkbox" name="buy" value="260" checked>&nbsp;
							</div>
							<div class="img">
								<img src="/img/cart.PNG" width="60">
							</div>
							<div class="pname">
								<span>찜마마(XJ-92214/3)</span>
							</div>
						</div>
						<div class="subdiv">
							<div class="basketprice">
								<input type="hidden" name="p_price" id="p_price1"
									class="p_price" value="20000">20,000원
							</div>
							<div class="num">
								<div class="updown">
									<input type="text" name="p_num1" id="p_num1" size="2"
										maxlength="4" class="p_num" value="2"> <span><i
										class="fas fa-arrow-alt-circle-up up"></i></span> <span><i
										class="fas fa-arrow-alt-circle-down down"></i></span>
								</div>
							</div>
							<div class="sum">40,000원</div>
						</div>
						<div class="subdiv">
							<div class="basketcmd">
								<a href="javascript:void(0)" class="abutton">삭제</a>
							</div>
						</div>
					</div>
				</div>

			</div>

			<div class="bigtext right-align sumcount" id="sum_p_num">상품갯수:
				</div>
			<div class="bigtext right-align box blue summoney" id="sum_p_price">합계금액:
				원</div>

			<div id="goorder" class="">
				<div class="clear"></div>
				<div class="buttongroup center-align cmd">
					<a href="javascript:alert('주문완료!!');">선택한 상품 주문</a>
				</div>
			</div>
		</form>
		<!--  -->
		
		<table style="border: 1px solid;">
				<thead style="text-align: center; border: 1px solid;">
					<tr>
						<th style="width: 150px;">상품 합계금액</th>
						<th style="width: 150px;"></th>
						<th style="width: 150px;">총 배송비</th>
						<th style="width: 150px;">적립금</th>
						<th style="width: 150px;"></th>
						<th style="width: 150px;">최종 결제금액</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td style="width: 70px; text-align: center;"
							>40,000원</td>
						<td>
								<div class="pic">
									<img style="width: 80px; height: 80px;"
										>
								</div>
						</td>
						<td style="text-align: center;" >0원</td>
						<td style="text-align: center;">0원</td>
						<td>
								<div class="pic">
									<img style="width: 80px; height: 80px;"
										>
								</div>
						</td>
						<td style="text-align: center;">40,000원</td>
					</tr>
				</tbody>
			</table> 
			
			<div class="right-align basketrowcmd">
				<a href="javascript:void(0)" class="abutton">선택상품삭제</a> <a
					href="javascript:void(0)" class="abutton">장바구니비우기</a>
			</div>

	</div>	
	
		<script>
	
	/* top 버튼 */
	document.querySelector('.top-btn').addEventListener('click', function() {
	    window.scrollTo({
	        top: 0,
	        behavior: 'smooth'
	    });
	});
	
	
	/* cart  */
	// 선택상품 삭제.
    document.querySelector('.basketrowcmd a:first-child').addEventListener('click', function () {
        basket.delCheckedItem();
        
       /* let checkItem = document.querySelectorAll('.row.data input[type="checkBox"]:checked');
        checkItem.forEach(function (item){
			let row = item.closest('row.data')
			let parent = row.parentNode;
			parent.removeChild(row);*/
	
    })

    // 장바구니 비우기.
    document.querySelector('.basketrowcmd a:nth-child(2)').addEventListener('click', function () {
        basket.delAllItem();
        
        /*let allItem = document.querySelectorAll('.row.data');
        allItem.forEach(function (allItem){
			allItem.parentNode.removeChild(allItem);
		*/
    })

    // 장바구나 삭제 클릭.
    document.querySelectorAll('.basketcmd a').forEach(function (item) {
        item.addEventListener('click', function () {
			
	/*	let row = this.closest('.row.data');
		row.parentNode.removeChild(row);	
			*/
            basket.delItem();
        })
    })

    // 수량변경 - 이벤트 종류 구분.
    document.querySelectorAll('.updown').forEach(function (item, idx) {
        item.querySelector('input').addEventListener('keyup', function () {
            basket.changePNum(idx);
            $('.num')
        })
        item.children[1].addEventListener('click', function () {
            basket.changePNum(idx);
        })
        item.children[2].addEventListener('click', function () {
            basket.changePNum(idx);
        })
    })

    // anchor : 스크롤 탑 차단.
    document.querySelectorAll('a[href="#"]').forEach(function (item) {
        item.setAttribute('href', 'javascript:void(0)');
    })
    
    /* basket  */
    
  //체크된 아이템 선택삭제
	delCheckedItem: function() {

		let checkItem = document.querySelectorAll('.row.data input[type="checkBox"]:checked');
		checkItem.forEach(function(item) {
			let row = item.closest('.row.data');
			let parent = row.parentNode;
			parent.removeChild(row);
		})
		console.log('delCheckedItem');

	},
	//장바구니 비우기
	delAllItem: function() {

		let delAllItem = document.querySelectorAll('.row.data');

		delAllItem.forEach(function(delAllItem) {
			delAllItem.parentNode.removeChild(delAllItem);
		})

		console.log('delAllItem');
	},

	reCalc: function() {
		console.log('reCalc');
		this.totalCount = 0;
		this.totalPrice = 0;
		
		
	},

	updateUI: function() {
		console.log('updateUI');

		let cval = event.target.parentNode.parentNode.childNodes[1].value;
		event.target.parentNode.parentNode.childNodes[1].value = parseInt(cval) + 1
		
		
		
		document.querySelectorAll('.p_num').forEach(function (item){
			let count = parseInt(item.getAttribute('value'));
			this.totalCount += count;
			
			//let price = 
			
		}, this);
	
		document.querySelector('#sum_p_num').textContent = '상품개수: ' + this.totalCount.formatNumber() + '개'
		document.querySelector('#sum_p_price').textContent = '합계금액: ' + this.totalPrice.formatNumber() + '원'
	},

	//수랑변경 
	changePNum: function(pos) {
		let target = document.querySelectorAll('div.row.data:nth-of-type(' + pos + ')');
		console.log("changePNum");

		console.log(event);
		if (event.target.tagName == 'INPUT') {
			console.log('input 클릭');
		} else if (event.target.tagName == 'I') {
			console.log('icon 클릭');

			//console.log(event.target.classList);
			if (event.target.classList.contains('up')) {
				console.log('icon 클릭. up'); //현재값에서 +1
				let cval = event.target.parentNode.parentNode.childNodes[1].value;
				event.target.parentNode.parentNode.childNodes[1].value = parseInt(cval) + 1
				console.log(event.target.parentNode.parentNode.parentNode.parentNode.childNodes[2].innerText);
				//console.log(event.target.parentNode.parentNode.childNode.value);
				//target.querySelector('input').value = 50;
			} else {
				console.log('icon 클릭. down'); //현재값에서 -1
				//target.querySelector('input').value = -50;
				let cval = event.target.parentNode.parentNode.childNodes[1].value;
				event.target.parentNode.parentNode.childNodes[1].value = parseInt(cval) - 1

			}
		}
	},
	//장바구니 단건 삭제
	delItem: function() {

		/*let row = this.closest('.row.data');
		row.parentNode.removeChild(row);	*/
		console.log(event.target.closest('div.row.data').remove());
		console.log('delItem');

	},

	cartList: function() {
		cartItems.forEach((item, idx) => {
			let template = document.querySelector('#template>div.row.data').cloneNode(true);
			template.querySelector('.img>img').setAttribute('src', '../img/' + item.image)
			template.querySelector('.pname>span').textContent = item.productNm
			template.querySelector('.basketprice>input').value = item.price
			template.querySelector('.basketprice').childNodes[2].textContent = item.price.formatNumber() + "원"
			template.querySelector('.updown>input').value = item.qty
			template.querySelector('.updown>input').setAttribute('value', item.qty)
			template.querySelector('.updown>input').setAttribute('id', 'p_num' + (idx + 1));
			template.querySelector('.sum').textContent = (item.price * item.qty).formatNumber() + "원"

			document.querySelector('#basket').append(template)
		})
	}
};

var cartItems = [{
	no: 1,
	productNm: '이것이 민트다.',
	qty: 2,
	price: 12000,
	image: 'item1.PNG'
},
{
	no: 2,
	productNm: '와 아이스크림.',
	qty: 1,
	price: 22000,
	image: 'item2.PNG'
},
{
	no: 3,
	productNm: '모나카 케익.',
	qty: 1,
	price: 13600,
	image: 'item3.PNG'
}
]

// 숫자 3자리 콤마찍기
Number.prototype.formatNumber = function() {
	if (this == 0) return 0;
	let regex = /(^[+-]?\d+)(\d{3})/;
	let nstr = (this + '');
	while (regex.test(nstr)) nstr = nstr.replace(regex, '$1' + ',' + '$2');
	return nstr;
};
	
	</script>
</body>
</html>