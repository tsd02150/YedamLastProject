<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">
<head>
<meta charset="UTF-8">
<title>basketList.html</title>
<link rel="stylesheet" type="text/css" href="css/farmList.css">
<link rel="stylesheet"
	href="mall/source/plugins/themefisher-font/style.css">
<link rel="stylesheet"
	href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
	integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/"
	crossorigin="anonymous">
<link rel="stylesheet" href="css/basketList.css" />

<link rel=" shortcut icon" href="/images/bzshopicon.ico">
<link rel="icon" href="/images/bzshopicon.ico">
<link
	href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,700'
	rel='stylesheet' type='text/css'>

<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<style>

/* 퀵메뉴 */
.quick-menu {
	position: fixed;
	top: 50%;
	right: 40px;
	transform: translateY(-50%);
	z-index: 9999;
	width: 80px; /* 퀵 메뉴의 가로 크기 조정 */
	height: 450px; /* 퀵 메뉴의 세로 크기 조정 */
	background-color: #f8f8f8;
	padding: 10px;
	border-radius: 40px; /* 직사각형 모양의 둥근 모서리를 위한 반지름 값 조정 */
	text-align: center; /* 내용 가운데 정렬 */
}

.quick-menu ul {
	list-style: none;
	padding: 0;
	margin: 0;
}

.quick-menu li {
	margin-bottom: 10px;
}

.quick-menu li a {
	text-decoration: none;
	color: #333;
}


/* basket */
body {
  margin: 0;
}

* {
  box-sizing: border-box;
}

p,
span {
  margin: 0;
}

a {
  color: black;
}

img {
  display: block;
  width: 80%;
  height: 80px;
  margin: auto;
}

.cart {
  width: 80%;
  margin: auto;
  padding: 30px;
}

.cart ul {
  background-color: whitesmoke;
  padding: 30px;
  margin-bottom: 50px;
  border: whitesmoke solid 1px;
  border-radius: 5px;
  font-size: 13px;
  font-weight: 300;
}

.cart ul :first-child {
  color: limegreen;
}

table {
  border-top: solid 1.5px black;
  border-collapse: collapse;
  width: 100%;
  font-size: 14px;
}

thead {
  text-align: center;
  font-weight: bold;
}

tbody {
  font-size: 12px;
}

td {
  padding: 15px 0px;
  border-bottom: 1px solid lightgrey;
}

.cart__list__detail :nth-child(3) {
  vertical-align: top;
}

.cart__list__detail :nth-child(3) a {
  font-size: 12px;
}

.cart__list__detail :nth-child(3) p {
  margin-top: 6px;
  font-weight: bold;
}

.cart__list__smartstore {
  font-size: 12px;
  color: gray;
}

.cart__list__option {
  vertical-align: top;
  padding: 20px;
}

.cart__list__option p {
  margin-bottom: 25px;
  position: relative;
}

.cart__list__option p::after {
  content: "";
  width: 90%;
  height: 1px;
  background-color: lightgrey;
  left: 0px;
  top: 25px;
  position: absolute;
}

.cart__list__optionbtn {
  background-color: white;
  font-size: 10px;
  border: lightgrey solid 1px;
  padding: 7px;
}

.cart__list__detail :nth-child(4),
.cart__list__detail :nth-child(5),
.cart__list__detail :nth-child(6) {
  border-left: 2px solid whitesmoke;
}

.cart__list__detail :nth-child(5),
.cart__list__detail :nth-child(6) {
  text-align: center;
}

.cart__list__detail :nth-child(5) button {
  background-color: limegreen;
  color: white;
  border: none;
  border-radius: 5px;
  padding: 4px 8px;
  font-size: 12px;
  margin-top: 5px;
}

.price {
  font-weight: bold;
}

.cart__mainbtns {
  width: 420px;
  height: 200px;
  padding-top: 40px;
  display: block;
  margin: auto;
}

.cart__bigorderbtn {
  width: 200px;
  height: 50px;
  font-size: 16px;
  margin: auto;
  border-radius: 5px;
}

.cart__bigorderbtn.left {
  background-color: white;
  border: 1px lightgray solid;
}

.cart__bigorderbtn.right {
  background-color: limegreen;
  color: white;
  border: none;
}
</style>


</head>
<body id="body">
	<div layout:fragment="content" class="outer-block">

		<!-- 퀵메뉴 -->
		<div class="quick-menu">
			<ul>
				<li th:onclick="|location.href='@{mallMain}'|"
					style="cursor: pointer;"><img
					style="width: 40ox; height: 40px;"
					src="https://cdn-icons-png.flaticon.com/128/4578/4578246.png"></li>
				<li style="font-size: 12px;"
					th:onclick="|location.href='@{mallMain}'|"><a href="#">포인트몰</a></li>

				<li
					th:onclick="|location.href='@{/mall/productList(commonCd=${'S1'})}'|"
					style="cursor: pointer;"><img
					style="width: 40ox; height: 40px;"
					src="https://cdn-icons-png.flaticon.com/128/2230/2230446.png"></li>
				<li style="font-size: 12px;"><a
					href="/mall/productList?commonCd=S1">농산물</a></li>


				<li
					th:onclick="|location.href='@{/mall/productList(commonCd=${'S2'})}'|"
					style="cursor: pointer;"><img
					style="width: 40ox; height: 40px;"
					src="https://cdn-icons-png.flaticon.com/128/3361/3361370.png"></li>
				<li style="font-size: 12px;"><a
					href="/mall/productList?commonCd=S2">수산물</a></li>


				<li th:onclick="|location.href='@{basketList}'|"
					style="cursor: pointer;"><img
					style="width: 40ox; height: 40px;"
					src="https://cdn-icons-png.flaticon.com/128/545/545489.png"></li>
				<li style="font-size: 12px;"
					th:onclick="|location.href='@{basketList}'|"><a href="#">장바구니</a></li>
				<li class="top-btn" style="font-size: 12px; cursor: pointer;"><img
					style="width: 40px; height: 40px;"
					src="https://cdn-icons-png.flaticon.com/128/6015/6015743.png"
					alt="Top Button"><a href="#">TOP</a></li>
			</ul>
		</div>

		<form name="orderform" id="orderform" method="post" class="orderform"
			action="/basketList">

			<section class="cart">
				<div class="cart__information">
					<ul>
						<li>장바구니 상품은 최대 30일간 저장됩니다.</li>
						<li>가격, 옵션 등 정보가 변경된 경우 주문이 불가할 수 있습니다.</li>
						<li>오늘출발 상품은 판매자 설정 시점에 따라 오늘출발 여부가 변경될 수 있으니 주문 시 꼭 다시 확인해
							주시기 바랍니다.</li>
					</ul>
				</div>
				<table class="cart__list">
					
						<thead>
							<tr>
								<td><input type="checkbox"></td>
								<td colspan="2">상품정보</td>
								<td>옵션</td>
								<td>상품금액</td>
								<td>배송비</td>
							</tr>
						</thead>
						<tbody id="basketList">
							<!-- <tr class="cart__list__detail">
								<td><input type="checkbox"></td>
								<td><img src="image/keyboard.jpg" alt="magic keyboard"></td>
								<td><a href="#">애플 공식 브랜드스토어</a><span
									class="cart__list__smartstore"> 스마트스토어</span>
									<p>Apple 매직 키보드 - 한국어(MK2A3KH/A)</p> <sapn class="price">116,62원</sapn><span
									style="text-decoration: line-through; color: lightgray;">119,000</span>
								</td>
								<td class="cart__list__option">
									<p>모델명 : 키보드 - 한국어 MK2A3KH/A / 1개</p>
									<button class="cart__list__optionbtn">주문조건 추가/변경</button>
								</td>
								<td><span class="price">116,620원</span><br>
									<button class="cart__list__orderbtn">주문하기</button></td>
								<td>무료</td>
							</tr>
							<tr class="cart__list__detail">
								<td style="width: 2%;"><input type="checkbox"></td>
								<td style="width: 13%;"><img src="image/mouse.jpg"
									alt="magic mouse"></td>
								<td style="width: 27%;"><a href="#">컴퓨존</a><span
									class="cart__list__smartstore"> 스마트스토어</span>
									<p>[애플] Magic Mouse [MK2E3KH/A]</p> <span class=" price">88,900원</span>
								</td>
								<td class="cart__list__option" style="width: 27%;">
									<p>상품 주문 수량: 1개</p>
									<button class="cart__list__optionbtn">주문조건 추가/변경</button>
								</td>
								<td style="width: 15%;"><span class="price">88,900원</span><br>
									<button class="cart__list__orderbtn">주문하기</button></td>
								<td style="width: 15%;">무료</td>
							</tr> -->
						</tbody>
						<tfoot>
							<tr>
								<td colspan="3"><input type="checkbox">
									<button class="cart__list__optionbtn">선택상품 삭제</button>
									<button class="cart__list__optionbtn">선택상품 찜</button></td>
								<td></td>
								<td></td>
								<td></td>
							</tr>
						</tfoot>
					
				</table>
				<div class="cart__mainbtns">
					<button class="cart__bigorderbtn left">쇼핑 계속하기</button>
					<button class="cart__bigorderbtn right">주문하기</button>
				</div>
			</section>
		</form>

		<!--  -->

		<table style="border: 1px solid;">
			<thead style="text-align: center; border: 1px solid;">
				<tr>
					<th style="width: 150px;">상품 합계금액</th>
					<th style="width: 150px;"></th>
					<th style="width: 150px;">총 배송비</th>
					<th style="width: 150px;">적립금</th>
					<th style="width: 150px;"></th>
					<th style="width: 150px;">최종 결제금액</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td style="width: 70px; text-align: center;">40,000원</td>
					<td>
						<div class="pic">
							<img style="width: 80px; height: 80px;">
						</div>
					</td>
					<td style="text-align: center;">0원</td>
					<td style="text-align: center;">0원</td>
					<td>
						<div class="pic">
							<img style="width: 80px; height: 80px;">
						</div>
					</td>
					<td style="text-align: center;">40,000원</td>
				</tr>
			</tbody>
		</table>

		<div class="right-align basketrowcmd">
			<a href="javascript:void(0)" class="abutton">선택상품삭제</a> <a
				href="javascript:void(0)" class="abutton">장바구니비우기</a>
		</div>

		<script th:inline="javascript">
	
	/* top 버튼 */
	document.querySelector('.top-btn').addEventListener('click', function() {
	    window.scrollTo({
	        top: 0,
	        behavior: 'smooth'
	    });
	});
	
	//
	
	basketList();
	
	// 장바구니 리스트 
	function basketList(){
		
		fetch("/mall/getBasketList", {
			method : "POST",
			headers : {
				
				'Content-type' : 'application/x-www-form-urlencoded'
			},
			body : "prdtNo=" 
		})
		.then(response=>response.json())
		.then(result => {
			result.forEach(item=> {
				console.log(item);
				let trTag=`
					<tr class="cart__list__detail">
					<td><input type="checkbox"></td>
					<td><img src="image/keyboard.jpg" alt="magic keyboard"></td>
					<td><a href="#">애플 공식 브랜드스토어</a><span
						class="cart__list__smartstore"> 스마트스토어</span>
						<p>Apple 매직 키보드 - 한국어(MK2A3KH/A)</p> <sapn class="price">${item.prdtNo}</sapn><span
						style="text-decoration: line-through; color: lightgray;">119,000</span>
					</td>
					<td class="cart__list__option">
						<p>모델명 : 키보드 - 한국어 MK2A3KH/A / 1개</p>
						<button class="cart__list__optionbtn">주문조건 추가/변경</button>
					</td>
					<td><span class="price">116,620원</span><br>
						<button onClick="" class="cart__list__orderbtn">주문하기</button></td>
					<td>무료</td>
				</tr>
			
				`;
				
				document.querySelector("#basketList").innerHTML+=trTag;
				
			})
		
		})
		.catch(err=>console.log(err));
		
	}
	
	/* let totalCount = 0;
	let totalPrice = 0;

	function delCheckedItem() {
	    let checkItem = document.querySelectorAll('.row.data input[type="checkBox"]:checked');
	    checkItem.forEach(function (item) {
	        let row = item.closest('.row.data');
	        let parent = row.parentNode;
	        parent.removeChild(row);
	    });
	    console.log('delCheckedItem');
	}

	function delAllItem() {
	    let delAllItem = document.querySelectorAll('.row.data');
	    delAllItem.forEach(function (delAllItem) {
	        delAllItem.parentNode.removeChild(delAllItem);
	    });
	    console.log('delAllItem');
	}

	function updateUI() {
	    console.log('updateUI');

	    let cval = event.target.parentNode.parentNode.childNodes[1].value;
	    event.target.parentNode.parentNode.childNodes[1].value = parseInt(cval) + 1;

	    document.querySelectorAll('.p_num').forEach(function (item) {
	        let count = parseInt(item.getAttribute('value'));
	        totalCount += count;
	    });

	    document.querySelector('#sum_p_num').textContent = '상품개수: ' + totalCount.formatNumber() + '개';
	    document.querySelector('#sum_p_price').textContent = '합계금액: ' + totalPrice.formatNumber() + '원';
	}

	function changePNum(pos) {
	    let target = document.querySelectorAll('div.row.data:nth-of-type(' + pos + ')');
	    console.log("changePNum");

	    console.log(event);
	    if (event.target.tagName == 'INPUT') {
	        console.log('input 클릭');
	    } else if (event.target.tagName == 'I') {
	        console.log('icon 클릭');

	        if (event.target.classList.contains('up')) {
	            console.log('icon 클릭. up');
	            let cval = event.target.parentNode.parentNode.childNodes[1].value;
	            event.target.parentNode.parentNode.childNodes[1].value = parseInt(cval) + 1;
	        } else {
	            console.log('icon 클릭. down');
	            let cval = event.target.parentNode.parentNode.childNodes[1].value;
	            event.target.parentNode.parentNode.childNodes[1].value = parseInt(cval) - 1;
	        }
	    }
	}

	function delItem() {
	    console.log(event.target.closest('div.row.data').remove());
	    console.log('delItem');
	}

	function cartList() {
	    cartItems.forEach((item, idx) => {
	        let template = document.querySelector('#template>div.row.data').cloneNode(true);
	        template.querySelector('.img>img').setAttribute('src', '../img/' + item.image)
	        template.querySelector('.pname>span').textContent = item.productNm
	        template.querySelector('.basketprice>input').value = item.price
	        template.querySelector('.basketprice').childNodes[2].textContent = item.price.formatNumber() + "원"
	        template.querySelector('.updown>input').value = item.qty
	        template.querySelector('.updown>input').setAttribute('value', item.qty)
	        template.querySelector('.updown>input').setAttribute('id', 'p_num' + (idx + 1));
	        template.querySelector('.sum').textContent = (item.price * item.qty).formatNumber() + "원"

	        document.querySelector('#basket').append(template)
	    })
	}

	// 숫자 3자리 콤마찍기
	Number.prototype.formatNumber = function () {
	    if (this == 0) return 0;
	    let regex = /(^[+-]?\d+)(\d{3})/;
	    let nstr = (this + '');
	    while (regex.test(nstr)) nstr = nstr.replace(regex, '$1' + ',' + '$2');
	    return nstr;
	};

	// 초기화 함수 실행
	function init() {
	    // 장바구니 목록 출력
	    cartList();

	    // 선택상품 삭제 버튼 이벤트 리스너 등록
	    document.querySelector('.basketrowcmd a:first-child').addEventListener('click', function () {
	        delCheckedItem();
	    });

	    // 장바구니 비우기 버튼 이벤트 리스너 등록
	    document.querySelector('.basketrowcmd a:nth-child(2)').addEventListener('click', function () {
	        delAllItem();
	    });

	    // 장바구니 아이템 삭제 버튼 이벤트 리스너 등록
	    document.querySelectorAll('.basketcmd a').forEach(function (item) {
	        item.addEventListener('click', function () {
	            delItem();
	        });
	    });

	    // 수량변경 이벤트 리스너 등록
	    document.querySelectorAll('.updown').forEach(function (item, idx) {
	        item.querySelector('input').addEventListener('keyup', function () {
	            changePNum(idx);
	        });
	        item.children[1].addEventListener('click', function () {
	            changePNum(idx);
	        });
	        item.children[2].addEventListener('click', function () {
	            changePNum(idx);
	        });
	    });

	    // <a> 태그의 href 속성에 "javascript:void(0)" 설정
	    document.querySelectorAll('a[href="#"]').forEach(function (item) {
	        item.setAttribute('href', 'javascript:void(0)');
	    });
	}

	// 초기화 함수 실행
	init();

	
	
	// 장바구니 목록을 배열로 정의
	var cartItems = [{
	        no: 1,
	        productNm: '이것이 민트다.',
	        qty: 2,
	        price: 12000,
	        image: 'item1.PNG'
	    },
	    {
	        no: 2,
	        productNm: '와 아이스크림.',
	        qty: 1,
	        price: 22000,
	        image: 'item2.PNG'
	    },
	    {
	        no: 3,
	        productNm: '모나카 케익.',
	        qty: 1,
	        price: 13600,
	        image: 'item3.PNG'
	    }
	];

	// 숫자 3자리 콤마찍기
	Number.prototype.formatNumber = function () {
	    if (this == 0) return 0;
	    var regex = /(^[+-]?\d+)(\d{3})/;
	    var nstr = (this + '');
	    while (regex.test(nstr)) nstr = nstr.replace(regex, '$1' + ',' + '$2');
	    return nstr;
	};

	//장바구니 단건 삭제
	function delItem() {
	    var row = this.closest('.row.data');
	    row.parentNode.removeChild(row);
	    console.log('delItem');
	}

	//수량변경 
	function changePNum(pos) {
	    var target = document.querySelectorAll('div.row.data:nth-of-type(' + pos + ')');
	    console.log("changePNum");

	    console.log(event);
	    if (event.target.tagName == 'INPUT') {
	        console.log('input 클릭');
	    } else if (event.target.tagName == 'I') {
	        console.log('icon 클릭');

	        //console.log(event.target.classList);
	        if (event.target.classList.contains('up')) {
	            console.log('icon 클릭. up'); //현재값에서 +1
	            var cval = event.target.parentNode.parentNode.childNodes[1].value;
	            event.target.parentNode.parentNode.childNodes[1].value = parseInt(cval) + 1;
	            console.log(event.target.parentNode.parentNode.parentNode.parentNode.childNodes[2].innerText);
	            //console.log(event.target.parentNode.parentNode.childNode.value);
	            //target.querySelector('input').value = 50;
	        } else {
	            console.log('icon 클릭. down'); //현재값에서 -1
	            //target.querySelector('input').value = -50;
	            var cval = event.target.parentNode.parentNode.childNodes[1].value;
	            event.target.parentNode.parentNode.childNodes[1].value = parseInt(cval) - 1;
	        }
	    }
	}

	// 장바구니 목록을 화면에 출력하는 함수
	function cartList() {
	    cartItems.forEach(function (item, idx) {
	        var template = document.querySelector('#template>div.row.data').cloneNode(true);
	        template.querySelector('.img>img').setAttribute('src', '../img/' + item.image);
	        template.querySelector('.pname>span').textContent = item.productNm;
	        template.querySelector('.basketprice>input').value = item.price;
	        template.querySelector('.basketprice').childNodes[2].textContent = item.price.formatNumber() + "원";
	        template.querySelector('.updown>input').value = item.qty;
	        template.querySelector('.updown>input').setAttribute('value', item.qty);
	        template.querySelector('.updown>input').setAttribute('id', 'p_num' + (idx + 1));
	        template.querySelector('.sum').textContent = (item.price * item.qty).formatNumber() + "원";
	        document.querySelector('#basket').append(template);
	    });
	}

	// 초기화 작업 수행
	function init() {
	    // 장바구니 목록 출력
	    cartList();

	    // 선택상품 삭제 버튼 이벤트 리스너 등록
	    document.querySelector('.basketrowcmd a:first-child').addEventListener('click', function () {
	        delCheckedItem();
	    });

	    // 장바구니 비우기 버튼 이벤트 리스너 등록
	    document.querySelector('.basketrowcmd a:nth-child(2)').addEventListener('click', function () {
	        delAllItem();
	    });

	    // 장바구니 아이템 삭제 버튼 이벤트 리스너 등록
	    document.querySelectorAll('.basketcmd a').forEach(function (item) {
	        item.addEventListener('click', function () {
	            delItem();
	        });
	    });

	    // 수량변경 이벤트 리스너 등록
	    document.querySelectorAll('.updown').forEach(function (item, idx) {
	        item.querySelector('input').addEventListener('keyup', function () {
	            changePNum(idx);
	        });
	        item.children[1].addEventListener('click', function () {
	            changePNum(idx);
	        });
	        item.children[2].addEventListener('click', function () {
	            changePNum(idx);
	        });
	    });

	    // <a> 태그의 href 속성에 "javascript:void(0)" 설정
	    document.querySelectorAll('a[href="#"]').forEach(function (item) {
	        item.setAttribute('href', 'javascript:void(0)');
	    });
	}

	// 초기화 함수 실행
	init();
 */

	
	</script>
	</div>
</body>
</html>